version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Checking for package.json and package-lock.json sync issues"
        - npm install
        - echo "Listing source files:"
        - find src -type f -name "*.jsx" -o -name "*.js" | sort
        - echo "Checking for missing FrontdeskDashboard.jsx..."
        - |
          if [ ! -f src/pages/FrontdeskDashboard.jsx ]; then
            echo "Creating FrontdeskDashboard.jsx..."
            cat > src/pages/FrontdeskDashboard.jsx << 'EOL'
            import React from "react";
            import { Container, Typography } from "@mui/material";

            function FrontdeskDashboard() {
              return (
                <Container>
                  <Typography variant="h4">Frontdesk Dashboard</Typography>
                </Container>
              );
            }

            export default FrontdeskDashboard;
            EOL
          fi
    build:
      commands:
        - echo "Building for environment: ${ENVIRONMENT:-prod}"
        - echo "REACT_APP_API_ENDPOINT=${API_ENDPOINT}" >> .env.production
        - echo "REACT_APP_COGNITO_REGION=${COGNITO_REGION}" >> .env.production
        - echo "REACT_APP_USER_POOL_ID=${USER_POOL_ID}" >> .env.production
        - echo "REACT_APP_USER_POOL_CLIENT_ID=${USER_POOL_CLIENT_ID}" >> .env.production
        - echo "REACT_APP_S3_BUCKET=${S3_BUCKET}" >> .env.production
        - echo "REACT_APP_S3_REGION=${S3_REGION}" >> .env.production
        - echo "VITE_API_ENDPOINT=${API_ENDPOINT}" >> .env.production
        - echo "VITE_COGNITO_REGION=${COGNITO_REGION}" >> .env.production
        - echo "VITE_USER_POOL_ID=${USER_POOL_ID}" >> .env.production
        - echo "VITE_USER_POOL_CLIENT_ID=${USER_POOL_CLIENT_ID}" >> .env.production
        - echo "VITE_S3_BUCKET=${S3_BUCKET}" >> .env.production
        - echo "VITE_S3_REGION=${S3_REGION}" >> .env.production
        # Create FrontdeskDashboard.jsx if it doesn't exist in the build environment
        - mkdir -p src/pages
        - |
          if [ ! -f src/pages/FrontdeskDashboard.jsx ]; then
            echo "Creating FrontdeskDashboard.jsx file..."
            cat > src/pages/FrontdeskDashboard.jsx << 'EOL'
            // src/pages/FrontdeskDashboard.jsx
            import React from "react";
            import { Container, Typography, Box } from "@mui/material";
            
            function FrontdeskDashboard() {
              return (
                <Container maxWidth="xl">
                  <Box sx={{ my: 4 }}>
                    <Typography variant="h4" component="h1" gutterBottom>
                      Frontdesk Dashboard
                    </Typography>
                    <Typography variant="body1">
                      Welcome to the Frontdesk Dashboard.
                    </Typography>
                  </Box>
                </Container>
              );
            }
            
            export default FrontdeskDashboard;
            EOL
          fi
        - npm run build
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths: []
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Strict-Transport-Security'
          value: 'max-age=31536000; includeSubDomains'
        - key: 'X-Content-Type-Options'
          value: 'nosniff'
        - key: 'X-XSS-Protection'
          value: '1; mode=block'
        - key: 'X-Frame-Options'
          value: 'SAMEORIGIN'